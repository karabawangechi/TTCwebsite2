"use strict";var express=require("express"),app=express(),bodyParser=require("body-parser"),session=require("express-session"),cookieParser=require("cookie-parser"),MongoStore=require("connect-mongo"),connectDB=require("./config/db.config"),multer=require("multer"),Contact=require("./models/contactform.js"),Registration=require("./models/register.js"),nodemailer=require("nodemailer"),router=express.Router();app.use(express.json()),app.use(bodyParser.urlencoded({extended:!1}));var PORT=process.env.PORT||5e3;app.use(cookieParser()),app.use(session({secret:"keyboard cat",resave:!1,saveUninitialized:!0,store:MongoStore.create({mongoUrl:"mongodb://127.0.0.1:27017/Mwencha"})})),app.use(express.static("assets")),app.set("view engine","ejs"),app.use("/assets",express.static("assets")),app.use(express.static("assets")),app.use(express.static("uploads")),app.use(express.static("node_modules")),app.use("/",router),router.get("/index",function(e,r){r.render("index.ejs")}),router.get("/about",function(e,r){r.render("about.ejs")}),router.get("/contact",function(e,r){r.render("contact.ejs")}),router.get("/courses",function(e,r){r.render("courses.ejs")}),router.get("/feesstructure",function(e,r){r.render("feesstructure.ejs")}),router.get("/register",function(e,r){r.render("register.ejs")}),router.get("/registerconfirmation",function(e,r){r.render("registerconfirmation.ejs")});var storage=multer.diskStorage({destination:function(e,r,t){t(null,"uploads/")},filename:function(e,r,t){t(null,r.originalname)}}),upload=multer({storage:storage});app.post("/register",upload.fields([{name:"admissionLetter",maxCount:1},{name:"nationalID",maxCount:1},{name:"kcseCertificate",maxCount:1},{name:"leavingCertificate",maxCount:1},{name:"birthCertificate",maxCount:1}]),function(r,t){var s,n,a,o,i,c,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=r.body,n=s.name,a=s.email,o=r.files,i=new Registration({name:n,email:a,admissionLetter:o.admissionLetter[0].path,nationalID:o.nationalID[0].path,kcseCertificate:o.kcseCertificate[0].path,leavingCertificate:o.leavingCertificate[0].path,birthCertificate:o.birthCertificate[0].path}),e.next=6,regeneratorRuntime.awrap(i.save());case 6:c=nodemailer.createTransport({service:"gmail",auth:{user:"Iseatout@gmail.com",pass:"iwrnouidsjrjvbzw"}}),u={from:"Iseatout@gmail.com",to:a,subject:"Registration Successful",text:"Thank you for registering with Mwencha TTC. Please note that you need to pay Ksh1000 unrefundable registration fee with Paybill 124536. Please forward the M-Pesa message to mwenchattc2023@gmail.com for confirmation."},c.sendMail(u,function(e,r){e?console.log("Error sending email:",e):console.log("Email sent:",r.response)}),t.render("registrationconfirmation.ejs"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("Error processing registration:",e.t0),t.status(500).json({error:"Internal Server Error"});case 16:case"end":return e.stop()}},null,null,[[0,12]])}),app.post("/contactform",function(r,t){var s,n,a,o,i,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=r.body,n=s.name,a=s.email,o=s.subject,i=s.message,c=new Contact({name:n,email:a,subject:o,message:i}),e.next=5,regeneratorRuntime.awrap(c.save());case 5:t.render("contact.ejs",{successMessage:"Your message has been sent. Thank you!"}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Error processing contact form:",e.t0),t.status(500).json({error:"Internal Server Error"});case 12:case"end":return e.stop()}},null,null,[[0,8]])}),app.listen(PORT,function(){console.log("App is listening on port ".concat(PORT))});
//# sourceMappingURL=server.min.js.map
