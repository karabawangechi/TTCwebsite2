"use strict";var express=require("express"),app=express(),bodyParser=require("body-parser"),session=require("express-session"),cookieParser=require("cookie-parser"),MongoStore=require("connect-mongo"),connectDB=require("./config/db.config"),multer=require("multer"),upload=multer({dest:"uploads/"}),router=express.Router();app.use(express.json()),app.use(bodyParser.urlencoded({extended:!1}));var PORT=process.env.PORT||5e3;function sendConfirmationEmail(r){var t,s,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=nodemailer.createTransport({service:"gmail",auth:{user:"",pass:""}}),s={from:"",to:r,subject:"Subscription Confirmation",text:"Thank you for subscribing to our newsletter! You will receive monthly updates on the best places to dine."},e.next=5,regeneratorRuntime.awrap(t.sendMail(s));case 5:return n=e.sent,console.log("Email sent:",n),e.abrupt("return",n);case 10:throw e.prev=10,e.t0=e.catch(0),console.error("Error sending email:",e.t0),e.t0;case 14:case"end":return e.stop()}},null,null,[[0,10]])}app.use(cookieParser()),app.use(session({secret:"keyboard cat",resave:!1,saveUninitialized:!0,store:MongoStore.create({mongoUrl:"mongodb://127.0.0.1:27017/Mwencha"})})),app.post("/register",upload.fields([{name:"admissionLetter",maxCount:1},{name:"nationalID",maxCount:1},{name:"kceseCertificate",maxCount:1},{name:"kcseResultSlip",maxCount:1},{name:"leavingCertificate",maxCount:1},{name:"birthCertificate",maxCount:1}]),function(r,t){var s,n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=r.body,n=r.files,s.admissionLetter=n.admissionLetter[0].path,s.nationalID=n.nationalID[0].path,s.kceseCertificate=n.kceseCertificate[0].path,s.kcseResultSlip=n.kcseResultSlip[0].path,s.leavingCertificate=n.leavingCertificate[0].path,s.birthCertificate=n.birthCertificate[0].path,a=new Registration(s),e.next=12,regeneratorRuntime.awrap(a.save());case 12:t.status(201).send("Registration successful!"),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),console.error(e.t0),t.status(500).send("Internal Server Error");case 19:case"end":return e.stop()}},null,null,[[0,15]])}),app.use(express.static("assets")),app.set("view engine","ejs"),app.use("/assets",express.static("assets")),app.use(express.static("assets")),app.use(express.static("uploads")),app.use(express.static("node_modules")),app.use("/",router),router.get("/index",function(e,r){r.render("index.ejs")}),router.get("/about",function(e,r){r.render("about.ejs")}),router.get("/contact",function(e,r){r.render("contact.ejs")}),router.get("/courses",function(e,r){r.render("courses.ejs")}),router.get("/register",function(e,r){r.render("courses.ejs")}),module.exports={sendConfirmationEmail:sendConfirmationEmail},app.listen(PORT,function(){console.log("App is listening on port ".concat(PORT))});
//# sourceMappingURL=server.min.js.map
