"use strict";var express=require("express"),app=express(),bodyParser=require("body-parser"),session=require("express-session"),cookieParser=require("cookie-parser"),MongoStore=require("connect-mongo"),connectDB=require("./config/db.config"),multer=require("multer"),Contact=require("./models/contactform.js"),Registration=require("./models/register.js"),Subscribe=require("./models/subscriber.js"),router=express.Router();app.use(express.json()),app.use(bodyParser.urlencoded({extended:!1}));var PORT=process.env.PORT||5e3;app.use(cookieParser()),app.use(session({secret:"keyboard cat",resave:!1,saveUninitialized:!0,store:MongoStore.create({mongoUrl:"mongodb://127.0.0.1:27017/Mwencha"})}));var storage=multer.diskStorage({destination:function(e,r,t){t(null,"uploads/")},filename:function(e,r,t){t(null,r.originalname)}}),upload=multer({storage:storage});function sendConfirmationEmail(r){var t,s,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=nodemailer.createTransport({service:"gmail",auth:{user:"Iseatout@gmail.com",pass:"dytjsxykactbirfc"}}),s={from:"Iseatout@gmail.com",to:r,subject:"Subscription Confirmation",text:"Thank you for subscribing to our newsletter! You will receive monthly updates on the best places to dine."},e.next=5,regeneratorRuntime.awrap(t.sendMail(s));case 5:return n=e.sent,console.log("Email sent:",n),e.abrupt("return",n);case 10:throw e.prev=10,e.t0=e.catch(0),console.error("Error sending email:",e.t0),e.t0;case 14:case"end":return e.stop()}},null,null,[[0,10]])}app.post("/register",upload.fields([{name:"admissionLetter",maxCount:1},{name:"nationalID",maxCount:1},{name:"kcseCertificate",maxCount:1},{name:"leavingCertificate",maxCount:1},{name:"birthCertificate",maxCount:1}]),function(r,t){var s,n,a,o,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=r.body,n=s.name,a=s.email,o=r.files,i=new Registration({name:n,email:a,admissionLetter:o.admissionLetter[0].path,nationalID:o.nationalID[0].path,kcseCertificate:o.kcseCertificate[0].path,leavingCertificate:o.leavingCertificate[0].path,birthCertificate:o.birthCertificate[0].path}),e.next=6,regeneratorRuntime.awrap(i.save());case 6:t.status(201).json({message:"Registration successful"}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Error processing registration:",e.t0),t.status(500).json({error:"Internal Server Error"});case 13:case"end":return e.stop()}},null,null,[[0,9]])}),app.use(express.static("assets")),app.set("view engine","ejs"),app.use("/assets",express.static("assets")),app.use(express.static("assets")),app.use(express.static("uploads")),app.use(express.static("node_modules")),app.use("/",router),router.get("/index",function(e,r){r.render("index.ejs")}),router.get("/about",function(e,r){r.render("about.ejs")}),router.get("/contact",function(e,r){r.render("contact.ejs")}),router.get("/courses",function(e,r){r.render("courses.ejs")}),router.get("/register",function(e,r){r.render("register.ejs")}),router.get("/contact",function(e,r){r.render("contact.ejs",{user:user})}),module.exports={sendConfirmationEmail:sendConfirmationEmail},app.post("/subscribe",function(r,t){var s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.body.email,e.prev=1,e.next=4,regeneratorRuntime.awrap(sendConfirmationEmail(s));case 4:({email:s}),t.render("Subscribe.ejs",{user:user}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.error("Error subscribing:",e.t0),t.status(500).json({error:"An error occurred"});case 12:case"end":return e.stop()}},null,null,[[1,8]])}),router.post("/contactform",function(r,t){var s,n,a,o,i,c,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.body,n=s.name,a=s.message,o=s.email,i=s.subject,c={name:n,message:a,subject:i,email:o},e.prev=2,e.next=5,regeneratorRuntime.awrap(Contact.create(c));case 5:u=e.sent,t.render("contact.ejs",{newContact:u}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),console.error("Error creating reply:",e.t0),t.status(500).json({error:"Internal Server Error"});case 13:case"end":return e.stop()}},null,null,[[2,9]])}),app.listen(PORT,function(){console.log("App is listening on port ".concat(PORT))});
//# sourceMappingURL=server.min.js.map
